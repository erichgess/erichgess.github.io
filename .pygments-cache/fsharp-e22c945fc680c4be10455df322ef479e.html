<div class="highlight"><pre><span class="k">type</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">=</span>
    <span class="o">|</span> <span class="nc">Branch</span> <span class="k">of</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">*</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">|</span> <span class="nc">Empty</span>

<span class="k">type</span> <span class="nc">Branch</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">=</span>
    <span class="o">|</span> <span class="nc">Left</span> <span class="k">of</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span>
    <span class="o">|</span> <span class="nc">Right</span> <span class="k">of</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span>

<span class="k">type</span> <span class="nc">TreeZipper</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nc">TreeZipper</span> <span class="k">of</span> <span class="k">&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">*</span> <span class="nc">Tree</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span> <span class="o">*</span> <span class="nc">Branch</span><span class="o">&lt;</span><span class="k">&#39;</span><span class="n">a</span><span class="o">&gt;</span> <span class="kt">list</span> <span class="k">with</span>
    <span class="k">static</span> <span class="k">member</span> <span class="n">create</span> <span class="n">t</span> <span class="o">=</span>
        <span class="k">match</span> <span class="n">t</span> <span class="k">with</span>
        <span class="o">|</span> <span class="nc">Empty</span> <span class="o">-&gt;</span> <span class="n">failwith</span> <span class="s2">&quot;oops&quot;</span>
        <span class="o">|</span> <span class="nc">Branch</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="bp">[]</span><span class="o">)</span>

    <span class="k">member</span> <span class="n">tz</span><span class="o">.</span><span class="n">left</span> <span class="bp">()</span> <span class="o">=</span>
        <span class="k">match</span> <span class="n">tz</span> <span class="k">with</span>
        <span class="o">|</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="nc">Empty</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">history</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">tz</span>
        <span class="o">|</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="nc">Branch</span><span class="o">(</span><span class="n">lx</span><span class="o">,</span> <span class="n">ll</span><span class="o">,</span> <span class="n">lr</span><span class="o">),</span> <span class="n">r</span><span class="o">,</span> <span class="n">history</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">lx</span><span class="o">,</span> <span class="n">ll</span><span class="o">,</span> <span class="n">lr</span><span class="o">,</span> <span class="nc">Right</span><span class="o">(</span> <span class="n">x</span><span class="o">,</span> <span class="n">r</span><span class="o">)::</span><span class="n">history</span><span class="o">)</span>

    <span class="k">member</span> <span class="n">tz</span><span class="o">.</span><span class="n">right</span> <span class="bp">()</span> <span class="o">=</span>
        <span class="k">match</span> <span class="n">tz</span> <span class="k">with</span>
        <span class="o">|</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="nc">Empty</span><span class="o">,</span> <span class="n">history</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">tz</span>
        <span class="o">|</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="nc">Branch</span><span class="o">(</span><span class="n">rx</span><span class="o">,</span> <span class="n">rl</span><span class="o">,</span> <span class="n">rr</span><span class="o">),</span> <span class="n">history</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">rx</span><span class="o">,</span> <span class="n">rl</span><span class="o">,</span> <span class="n">rr</span><span class="o">,</span> <span class="nc">Left</span><span class="o">(</span> <span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">)::</span><span class="n">history</span><span class="o">)</span>

    <span class="k">member</span> <span class="n">tz</span><span class="o">.</span><span class="n">back</span> <span class="bp">()</span> <span class="o">=</span>
        <span class="k">match</span> <span class="n">tz</span> <span class="k">with</span>
        <span class="o">|</span> <span class="nc">TreeZipper</span><span class="o">(_,</span> <span class="o">_,</span> <span class="o">_,</span> <span class="bp">[]</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">tz</span>
        <span class="o">|</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="nc">Right</span><span class="o">(</span> <span class="n">hx</span><span class="o">,</span> <span class="n">hr</span><span class="o">)::</span><span class="n">history</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">hx</span><span class="o">,</span> <span class="nc">Branch</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">),</span> <span class="n">hr</span><span class="o">,</span> <span class="n">history</span><span class="o">)</span>
        <span class="o">|</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="nc">Left</span><span class="o">(</span> <span class="n">hx</span><span class="o">,</span> <span class="n">hl</span><span class="o">)::</span><span class="n">history</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">hx</span><span class="o">,</span> <span class="n">hl</span><span class="o">,</span> <span class="nc">Branch</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">),</span> <span class="n">history</span><span class="o">)</span>

    <span class="k">member</span> <span class="n">tz</span><span class="o">.</span><span class="n">update</span> <span class="n">x</span> <span class="o">=</span>
        <span class="k">let</span> <span class="o">(</span><span class="nc">TreeZipper</span><span class="o">(_,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">history</span><span class="o">))</span> <span class="o">=</span> <span class="n">tz</span> <span class="k">in</span> <span class="nc">TreeZipper</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">l</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">history</span><span class="o">)</span>
</pre></div>