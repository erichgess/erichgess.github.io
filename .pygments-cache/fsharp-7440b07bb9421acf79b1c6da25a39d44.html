<div class="highlight"><pre><span class="k">let</span> <span class="k">rec</span> <span class="n">union</span> <span class="n">comparer</span> <span class="n">t1</span> <span class="n">t2</span> <span class="o">=</span>
    <span class="c1">// Perf: tried bruteForce for low heights, but nothing significant </span>
    <span class="k">match</span> <span class="n">t1</span><span class="o">,</span><span class="n">t2</span> <span class="k">with</span>             <span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
    <span class="o">|</span> <span class="nc">SetNode</span><span class="o">(</span><span class="n">k1</span><span class="o">,</span><span class="n">t11</span><span class="o">,</span><span class="n">t12</span><span class="o">,</span><span class="n">h1</span><span class="o">),</span><span class="nc">SetNode</span><span class="o">(</span><span class="n">k2</span><span class="o">,</span><span class="n">t21</span><span class="o">,</span><span class="n">t22</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="c1">// (t11 &amp;lt; k &amp;lt; t12) AND (t21 &amp;lt; k2 &amp;lt; t22) </span>
        <span class="c1">// Divide and Conquer:</span>
        <span class="c1">//   Suppose t1 is largest.</span>
        <span class="c1">//   Split t2 using pivot k1 into lo and hi.</span>
        <span class="c1">//   Union disjoint subproblems and then combine. </span>
        <span class="k">if</span> <span class="n">h1</span> <span class="o">&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">h2</span> <span class="k">then</span>
          <span class="k">let</span> <span class="n">lo</span><span class="o">,&lt;</span><span class="n">em</span><span class="o">&gt;,</span><span class="n">hi</span> <span class="o">=</span> <span class="n">split</span> <span class="n">comparer</span> <span class="n">k1</span> <span class="n">t2</span> <span class="k">in</span>
          <span class="n">balance</span> <span class="n">comparer</span> <span class="o">(</span><span class="n">union</span> <span class="n">comparer</span> <span class="n">t11</span> <span class="n">lo</span><span class="o">)</span> <span class="n">k1</span> <span class="o">(</span><span class="n">union</span> <span class="n">comparer</span> <span class="n">t12</span> <span class="n">hi</span><span class="o">)</span>
        <span class="k">else</span>
          <span class="k">let</span> <span class="n">lo</span><span class="o">,&lt;/</span><span class="n">em</span><span class="o">&gt;,</span><span class="n">hi</span> <span class="o">=</span> <span class="n">split</span> <span class="n">comparer</span> <span class="n">k2</span> <span class="n">t1</span> <span class="k">in</span>
          <span class="n">balance</span> <span class="n">comparer</span> <span class="o">(</span><span class="n">union</span> <span class="n">comparer</span> <span class="n">t21</span> <span class="n">lo</span><span class="o">)</span> <span class="n">k2</span> <span class="o">(</span><span class="n">union</span> <span class="n">comparer</span> <span class="n">t22</span> <span class="n">hi</span><span class="o">)</span>
    <span class="o">|</span> <span class="nc">SetEmpty</span><span class="o">,</span><span class="n">t</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">t</span>
    <span class="o">|</span> <span class="n">t</span><span class="o">,</span><span class="nc">SetEmpty</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">t</span>
    <span class="o">|</span> <span class="nc">SetOne</span> <span class="n">k1</span><span class="o">,</span><span class="n">t2</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">add</span> <span class="n">comparer</span> <span class="n">k1</span> <span class="n">t2</span>
    <span class="o">|</span> <span class="n">t1</span><span class="o">,</span><span class="nc">SetOne</span> <span class="n">k2</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="n">add</span> <span class="n">comparer</span> <span class="n">k2</span> <span class="n">t1</span>
</pre></div>