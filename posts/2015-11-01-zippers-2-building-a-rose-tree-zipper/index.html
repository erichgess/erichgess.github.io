<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Zippers 2: Building a Rose Tree Zipper | Elegant Architecture</title>
<meta name=viewport content="width=device-width,minimum-scale=1">
<meta name=description content="As a follow up to my post about Zippers for lists and binary trees, I wanted to create a zipper for a slightly more complex data structure. The Rose Tree is a tree structure where the number of branches a node may have is variable. An example of a rose tree would be the directory structure on your computer: each directory may contain 0 or more sub directories which, in turn, may contain addition subdirectories.">
<meta name=generator content="Hugo 0.87.0">
<meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel=stylesheet href=/ananke/css/main.min.css>
<meta property="og:title" content="Zippers 2: Building a Rose Tree Zipper">
<meta property="og:description" content="As a follow up to my post about Zippers for lists and binary trees, I wanted to create a zipper for a slightly more complex data structure. The Rose Tree is a tree structure where the number of branches a node may have is variable. An example of a rose tree would be the directory structure on your computer: each directory may contain 0 or more sub directories which, in turn, may contain addition subdirectories.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://example.org/posts/2015-11-01-zippers-2-building-a-rose-tree-zipper/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2015-11-01T09:38:55+00:00">
<meta property="article:modified_time" content="2015-11-01T09:38:55+00:00">
<meta itemprop=name content="Zippers 2: Building a Rose Tree Zipper">
<meta itemprop=description content="As a follow up to my post about Zippers for lists and binary trees, I wanted to create a zipper for a slightly more complex data structure. The Rose Tree is a tree structure where the number of branches a node may have is variable. An example of a rose tree would be the directory structure on your computer: each directory may contain 0 or more sub directories which, in turn, may contain addition subdirectories."><meta itemprop=datePublished content="2015-11-01T09:38:55+00:00">
<meta itemprop=dateModified content="2015-11-01T09:38:55+00:00">
<meta itemprop=wordCount content="711">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Zippers 2: Building a Rose Tree Zipper">
<meta name=twitter:description content="As a follow up to my post about Zippers for lists and binary trees, I wanted to create a zipper for a slightly more complex data structure. The Rose Tree is a tree structure where the number of branches a node may have is variable. An example of a rose tree would be the directory structure on your computer: each directory may contain 0 or more sub directories which, in turn, may contain addition subdirectories.">
<script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\\[','\\]']],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}},window.addEventListener('load',a=>{document.querySelectorAll("mjx-container").forEach(function(a){a.parentElement.classList+='has-jax'})})</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
</head>
<body class="ma0 avenir bg-near-white">
<header>
<div class=bg-black>
<nav class="pv3 ph3 ph4-ns" role=navigation>
<div class="flex-l justify-between items-center center">
<a href=/ class="f3 fw2 hover-white no-underline white-90 dib">
Elegant Architecture
</a>
<div class="flex-l items-center">
</div>
</div>
</nav>
</div>
</header>
<main class=pb7 role=main>
<article class="flex-l flex-wrap justify-between mw8 center ph3">
<header class="mt4 w-100">
<aside class="instapaper_ignoref b helvetica tracked">
POSTS
</aside>
<div id=sharing class=mt3>
<a href="https://www.facebook.com/sharer.php?u=http://example.org/posts/2015-11-01-zippers-2-building-a-rose-tree-zipper/" class="facebook no-underline" aria-label="share on Facebook"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765 50.32h6.744V33.998h4.499l.596-5.624h-5.095l.007-2.816c0-1.466.14-2.253 2.244-2.253h2.812V17.68h-4.5c-5.405.0-7.307 2.729-7.307 7.317v3.377h-3.369v5.625h3.369V50.32zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg>
</a>
<a href="https://twitter.com/share?url=http://example.org/posts/2015-11-01-zippers-2-building-a-rose-tree-zipper/&text=Zippers%202:%20Building%20a%20Rose%20Tree%20Zipper" class="twitter no-underline" aria-label="share on Twitter"><svg height="32" style="enable-background:new 0 0 67 67" viewBox="0 0 67 67" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167 22.283c-2.619.953-4.274 3.411-4.086 6.101l.063 1.038-1.048-.127c-3.813-.487-7.145-2.139-9.974-4.915l-1.383-1.377-.356 1.017c-.754 2.267-.272 4.661 1.299 6.271.838.89.649 1.017-.796.487-.503-.169-.943-.296-.985-.233-.146.149.356 2.076.754 2.839.545 1.06 1.655 2.097 2.871 2.712l1.027.487-1.215.021c-1.173.0-1.215.021-1.089.467.419 1.377 2.074 2.839 3.918 3.475l1.299.444-1.131.678c-1.676.976-3.646 1.526-5.616 1.568C19.775 43.256 19 43.341 19 43.405c0 .211 2.557 1.397 4.044 1.864 4.463 1.377 9.765.783 13.746-1.568 2.829-1.673 5.657-5 6.978-8.221.713-1.716 1.425-4.851 1.425-6.354.0-.975.063-1.102 1.236-2.267.692-.678 1.341-1.419 1.467-1.631.21-.403.188-.403-.88-.043-1.781.636-2.033.551-1.152-.402.649-.678 1.425-1.907 1.425-2.267.0-.063-.314.042-.671.233-.377.212-1.215.53-1.844.72l-1.131.361-1.027-.7c-.566-.381-1.361-.805-1.781-.932C39.766 21.902 38.131 21.944 37.167 22.283zM33 64C16.432 64 3 50.569 3 34S16.432 4 33 4s30 13.431 30 30S49.568 64 33 64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
<a href="https://www.linkedin.com/shareArticle?mini=true&url=http://example.org/posts/2015-11-01-zippers-2-building-a-rose-tree-zipper/&title=Zippers%202:%20Building%20a%20Rose%20Tree%20Zipper" class="linkedin no-underline" aria-label="share on LinkedIn"><svg height="32" style="enable-background:new 0 0 65 65" viewBox="0 0 65 65" width="32" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M50.837 48.137V36.425c0-6.275-3.35-9.195-7.816-9.195-3.604.0-5.219 1.983-6.119 3.374V27.71h-6.79c.09 1.917.0 20.427.0 20.427h6.79V36.729c0-.609.044-1.219.224-1.655.49-1.22 1.607-2.483 3.482-2.483 2.458.0 3.44 1.873 3.44 4.618v10.929H50.837zM22.959 24.922c2.367.0 3.842-1.57 3.842-3.531-.044-2.003-1.475-3.528-3.797-3.528s-3.841 1.524-3.841 3.528c0 1.961 1.474 3.531 3.753 3.531H22.959zM34 64C17.432 64 4 50.568 4 34 4 17.431 17.432 4 34 4s30 13.431 30 30c0 16.568-13.432 30-30 30zM26.354 48.137V27.71h-6.789v20.427h6.789z" style="fill-rule:evenodd;clip-rule:evenodd;fill:"/></svg>
</a>
</div>
<h1 class="f1 athelas mt3 mb1">Zippers 2: Building a Rose Tree Zipper</h1>
<time class="f6 mv4 dib tracked" datetime=2015-11-01T09:38:55Z>November 1, 2015</time>
</header>
<div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>As a follow up to my post about Zippers for lists and binary trees, I wanted to create a zipper for
a slightly more complex data structure. The Rose Tree is a tree structure where the number of
branches a node may have is variable. An example of a rose tree would be the directory structure
on your computer: each directory may contain 0 or more sub directories which, in turn, may contain
addition subdirectories. With this example in mind, the zipper is analagous to you moving through
your computers file system: starting at the root directory and using <code>cd</code> to move down a branch
and <code>cd ..</code> to move back.</p>
<h2 id=rose-tree-implementation>Rose Tree Implementation</h2>
<p>The implementation of a rose tree is pretty simple. It&rsquo;s just like a binary tree but, instead of
each node having two branches, each node has a list of branches:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>RoseTree</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>&#39;</span>a<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span>
  <span style=color:#f92672>|</span> Empty
  <span style=color:#f92672>|</span> RoseTree <span style=color:#66d9ef>of</span> <span style=color:#66d9ef>&#39;</span>a <span style=color:#f92672>*</span> <span style=color:#f92672>(</span>RoseTree<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>&#39;</span>a<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>list</span><span style=color:#f92672>)</span>
</code></pre></div><p>The zipper of the rose tree, however, is a lot more interesting and fun. It&rsquo;s basically a
combination of the binary tree zipper and the list zipper: you need a tree zipper to keep track
of where in the tree you are by level and a list zipper to keep track of where in the each node&rsquo;s
list of branches you are.</p>
<p>Algebraicly, the rose tree is:
$$R = 1 + a\cdot L(R)$$</p>
<p>Where $$L(R)$$ is a list of rose trees.</p>
<p>The derivative is:</p>
<p>\[
\begin{eqnarray}
\partial_aR &=& L(R) + a\partial_aL(R)\partial_aR \\<br>
\partial_aR - a\partial_aL(R)\partial_aR &=& L(R) \\<br>
(1 - a\partial_aL(R))\partial_aR &=& L(R) \\<br>
\partial_aR &=& \frac{L(R)}{1-a\partial_aL(R)} \\<br>
&=& L(R)\frac{1}{1 - a\partial_aL(R)} \\<br>
&=& L(R)L(a\partial_aL(R)) \\<br>
&=& L(R)L(aL^2(R)) \\<br>
\end{eqnarray}
\]</p>
<p>The next to last step uses the identity $$L(a) = \frac{1}{1 - a}$$ to arrive at $$L(R)L(aL^2(R))$$.</p>
<p>This translates to the type:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fsharp data-lang=fsharp><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>RoseTreeZipper</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>&#39;</span>a<span style=color:#f92672>&gt;</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>&#39;</span>a <span style=color:#f92672>*</span> RoseTree<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>&#39;</span>a<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>list</span> <span style=color:#f92672>*</span> <span style=color:#f92672>((</span><span style=color:#66d9ef>&#39;</span>a <span style=color:#f92672>*</span> RoseTree<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>&#39;</span>a<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>list</span> <span style=color:#f92672>*</span> RoseTree<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>&#39;</span>a<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>list</span><span style=color:#f92672>)</span> <span style=color:#66d9ef>list</span><span style=color:#f92672>)</span>
</code></pre></div><p>and that looks pretty insane.</p>
<p>However, it does make sense. Here&rsquo;s the break down. The first part <code>'a</code> is the value of the current
node and the <code>RoseTree&lt;'a> list</code> is the list of branches at this node. So, together
<code>'a * RoseTree&lt;'a> list</code> is the cursors current position in the rose tree.</p>
<p>Now here&rsquo;s the break down for <code>('a * RoseTree&lt;'a> list * RoseTree&lt;'a> list) list</code>. This is a list of
the previous positions the cursor had in the rose tree, just like we saw with the binary tree zipper.
The <code>'a</code> is the value of the node the cursor used to point at. The tuple <code>RoseTree&lt;'a> list * RoseTree&lt;'a> list</code>
is all the branches of the node except where the cursor is currently at! The first <code>RoseTree&lt;'a> list</code>
is the branches to the left of the branch down which the cursor went and the second <code>RoseTree&lt;'a> list</code>
is all the branches to the right!</p>
<p>To help clarify how the rose tree zipper works, here&rsquo;s a visual explanation.</p>
<p>The color green indicates the position of the cursor.</p>
<p>Here we are with a newly created zipper on a rose tree. The cursor is pointing to the root of the tree
<img src=/images/zippers/rosetree_1.png alt="My helpful screenshot"></p>
<p>We&rsquo;ll move the cursor down to the middle branch. The root of the tree and the left and right branches
are then moved into the history list for the cursor. The color blue is used to show that all those
nodes are grouped together as one entry in the history list.
![Moving the cursor]({{ site.url}}/assets/zippers/rosetree_2.png)</p>
<p>Here&rsquo;s a visual of the rose tree zipper value after the cursor is moved to the middle node. The cursor
points to (C, [G; H]), corresponding to the <code>'a * RoseTree&lt;'a> list</code> in the zipper type. The previous
cursor position corresponds to the list of <code>'a * RoseTree&lt;'a> list * RoseTree&lt;'a> list</code>.
<img src=/images/zippers/rosetree_2_note.png alt="The zipper type"></p>
<p>Moving the cursor down the left branch, the previous node and the right branch are colored to indicate
that they are grouped together and prepended to the history list.
<img src=/images/zippers/rosetree_3.png alt="Move cursor down left branch"></p>
<p>Visualizing the new rose tree zipper value. <code>C, H</code> have been moved to the head of the history list.
<code>H</code> is moved into the list of branches to the right of where the cursor is. The list of branches to
the left is empty, since this subtree only had two branches. <code>C</code> is moved into the node value of the
entry.
<img src=/images/zippers/rosetree_3_note.png alt="New rose tree zipper value"></p>
<ul class=pa0>
</ul>
<div class="mt6 instapaper_ignoref">
</div>
</div>
<aside class="w-30-l mt6-l">
</aside>
</article>
</main>
<footer class="bg-black bottom-0 w-100 pa3" role=contentinfo>
<div class="flex justify-between">
<a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://example.org/>
&copy; Elegant Architecture 2021
</a>
<div>
</div>
</div>
</footer>
</body>
</html>